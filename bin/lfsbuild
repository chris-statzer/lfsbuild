#!/usr/bin/env python2.7

cli = """
Usage:
    lfsbuild build <package>
"""

import sys
import os
import logging

from docopt import docopt

sys.path.insert(0, "./")
from lfsbuild.task import Task, load_tasks
from lfsbuild import config


logging.basicConfig(level=logging.INFO)
log = logging.getLogger('BUILD')

# check paths and make them if needed
paths = [config.CACHE_PATH,
         config.SOURCE_PATH,
         config.PATCH_PATH,
         config.BUILD_PATH]
for p in paths:
    if not os.path.isdir(p):
        os.mkdir(p)

# load all the tasks into a dict
tasks = load_tasks()


def build(package):
    if package in tasks:
        tasks[package].run()
    else:
        log.error('Package {} not found!'.format(package))


if __name__ == '__main__':
    arguments = docopt(cli)
    if arguments['build']:
        build(arguments['<package>'])

    #for n, t in tasks.items():
    #    t.run()
